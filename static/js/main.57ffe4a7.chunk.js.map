{"version":3,"sources":["components/Form.module.css","components/Form.js","components/PaymentModal.js","components/AnalysisSection.js","api.js","App.js","reportWebVitals.js","index.js"],"names":["module","exports","Form","_ref","onSubmit","formData","setFormData","useState","name","gender","calendarType","year","month","day","hour","minute","province","city","years","Array","from","length","_","i","days","hours","toString","padStart","minutes","provinces","citydata","filter","item","pid","cities","filteredCities","selectedProvince","find","prov","id","_jsxs","e","preventDefault","alert","genders","solarDate","lunarMonth","isLeap","leapMonth","startsWith","lunarDate","window","p","Lunar2Solar","yi","mi","dz","selectedCity","c","J","j","W","w","eightCharacter","raw","txt","sz","join","xb","x","a","transformUserData","fatemaps","parseInt","datetimeStr","console","log","className","styles","formContainer","children","_jsx","formRow","inputGroup","type","placeholder","underlineInput","value","onChange","target","buttonGroup","map","choiceButton","active","onClick","formRow1","dateSelectGroup","dateSelect","index","timeSelectGroup","formRow3","style","marginRight","disabled","submitButton","PaymentModal","isOpen","qrcodeUrl","onClose","countdown","setCountdown","useEffect","timer","setInterval","prev","Math","max","clearInterval","_Fragment","QRCodeSVG","size","fgColor","level","seconds","floor","ANALYSIS_TYPES","icon","color","AnalysisSection","preview","unlocked","contents","onUnlock","onGoBack","onComplete","displayContent","setDisplayContent","blurContent","setBlurContent","selectedType","setSelectedType","loadingType","setLoadingType","contentRef","useRef","isShared","setIsShared","isCopied","setIsCopied","watermarkImage","Image","src","splitIndex","slice","ref","ReactMarkdown","async","navigator","clipboard","writeText","location","href","setTimeout","confirm","err","backgroundColor","typeId","error","handleUnlock","canvas","html2canvas","current","useCORS","allowTaint","logging","watermarkCanvas","document","createElement","ctx","getContext","width","height","drawImage","fillStyle","font","textAlign","textBaseline","fillText","globalAlpha","finalUrl","toDataURL","link","download","Date","toLocaleDateString","body","appendChild","click","removeChild","BASE_URL","createEventSourceWithRetry","url","handlers","es","EventSource","retryCount","isConnected","onopen","onerror","_handlers$onError","onError","call","close","App","analysisData","setAnalysisData","currentOrderId","health","career","wealth","marriage","paymentState","setPaymentState","show","processingType","loading","setLoading","setError","setES","data","localStorage","setItem","JSON","stringify","saveAnalysisToLocalStorage","loadedData","loadAnalysisFromLocalStorage","getItem","parsedData","parse","alt","paymentES","initiatePayment","prevOrderId","analysisType","addEventListener","_handlers$onPaymentQR","onPaymentQR","orderId","_handlers$onPaymentst","onPaymentstatus","_handlers$onAnalysisC","onAnalysisChunk","content","_handlers$onAnalysisE","onAnalysisEnd","_handlers$onError3","message","chunk","analysisTypes","clearAnalysisData","removeItem","datatime","eightCharacters","newES","createOrderStream","encodeURIComponent","_handlers$onStream","onStream","_handlers$onComplete","_handlers$onError2","qrcode","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","createRoot","getElementById","render","React","StrictMode"],"mappings":"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","file":"static/js/main.57ffe4a7.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"formContainer\":\"Form_formContainer__30bom\",\"formRow\":\"Form_formRow__3daMv\",\"formRow1\":\"Form_formRow1__XS48M\",\"formRow3\":\"Form_formRow3__3AhXh\",\"inputGroup\":\"Form_inputGroup__EaPaw\",\"underlineInput\":\"Form_underlineInput__1EWfm\",\"optional\":\"Form_optional__5hbdU\",\"buttonGroup\":\"Form_buttonGroup__7LocG\",\"choiceButton\":\"Form_choiceButton__MMaii\",\"active\":\"Form_active__TTwYc\",\"dateSelectGroup\":\"Form_dateSelectGroup__32CjE\",\"dateSelect\":\"Form_dateSelect__3YUVx\",\"timeSelectGroup\":\"Form_timeSelectGroup__3IR3b\",\"underlineSelect\":\"Form_underlineSelect__1jtox\",\"citySelect\":\"Form_citySelect__3SZdv\",\"submitButton\":\"Form_submitButton__1NJMU\"};","import React, { useState } from 'react';\r\nimport styles from './Form.module.css';\r\nimport citydata from \"./city.json\"\r\n\r\nconst Form = ({ onSubmit }) => {\r\n  const [formData, setFormData] = useState({\r\n    name: '佚名',\r\n    gender: '男', // 设置默认值\r\n    calendarType: '公历', // 设置默认值\r\n    year: '1998',\r\n    month: '10',\r\n    day: '10',\r\n    hour: '18',\r\n    minute: '00',\r\n    province: '北京市',\r\n    city: '北京市'\r\n  });\r\n\r\n  // 生成年份选项（1900-2050）\r\n  const years = Array.from({length: 151}, (_, i) => 1900 + i);\r\n  // const months = Array.from({length: 12}, (_, i) => i + 1);\r\n  const days = Array.from({length: 31}, (_, i) => i + 1);\r\n  // 农历月份选项，包括可能的闰月\r\n  const updateMonthOptions = () => {\r\n    if (formData.calendarType === '农历') {\r\n      return [\r\n        '正月', '二月', '三月', '四月', '五月', '六月',\r\n        '七月', '八月', '九月', '十月', '十一月', '十二月',\r\n        '闰正月', '闰二月', '闰三月', '闰四月', '闰五月', '闰六月',\r\n        '闰七月', '闰八月', '闰九月', '闰十月', '闰十一月', '闰十二月'\r\n      ];\r\n    }\r\n    return Array.from({length: 12}, (_, i) => i + 1);\r\n  };\r\n  \r\n  \r\n\r\n  // 生成时间选项\r\n  const hours = Array.from({length: 24}, (_, i) => i.toString().padStart(2, '0'));\r\n  const minutes = Array.from({length: 60}, (_, i) => i.toString().padStart(2, '0'));\r\n  //设置省份、城市规则\r\n  const provinces = citydata.city.filter(item => item.pid === 0);\r\n  const cities = citydata.city.filter(item => item.pid !== 0);\r\n\r\n  const handleProvinceChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      province: e.target.value,\r\n      city: 'unknown'\r\n    });\r\n  };\r\n\r\n  const handleCityChange = (e) => {\r\n    setFormData({ ...formData, city: e.target.value });\r\n  };\r\n\r\n  const filteredCities = cities.filter(city => {\r\n    const selectedProvince = provinces.find(prov => prov.name === formData.province);\r\n    return selectedProvince && city.pid === selectedProvince.id;\r\n  });\r\n  \r\n\r\n// 确保在组件顶部定义了handleSubmit函数\r\nconst handleSubmit = (e) => {\r\n  e.preventDefault(); // 必须阻止默认行为\r\n  // console.log('提交数据：', formData);\r\n  \r\n  // 添加基础验证\r\n  if (!formData.year || !formData.month || !formData.day) {\r\n    alert('请选择完整的出生日期');\r\n    return;\r\n  }\r\n  if (formData.province === 'unknown' || formData.city === 'unknown') {\r\n    alert('请选择完整的地区信息');\r\n    return;\r\n  }\r\n\r\n  //性别判断\r\n  let genders\r\n  if (formData.gender === '男') { \r\n    genders = 0;\r\n  }else {\r\n      genders = 1;\r\n    }\r\n  //农历转公历\r\n  // 月份映射表\r\n  const monthMap = {\r\n    '正月': 1, '二月': 2, '三月': 3, '四月': 4, '五月': 5, '六月': 6,\r\n    '七月': 7, '八月': 8, '九月': 9, '十月': 10, '十一月': 11, '十二月': 12,\r\n    '闰正月': 1, '闰二月': 2, '闰三月': 3, '闰四月': 4, '闰五月': 5, '闰六月': 6,\r\n    '闰七月': 7, '闰八月': 8, '闰九月': 9, '闰十月': 10, '闰十一月': 11, '闰十二月': 12\r\n  };\r\n\r\n  let solarDate;\r\n  let lunarMonth = monthMap[formData.month]; \r\n  let isLeap = formData.leapMonth;\r\n  if (formData.calendarType === '农历') {\r\n    if (formData.month.startsWith('闰')) {\r\n      isLeap = true;\r\n    }\r\n    const lunarDate = window.p.Lunar2Solar(formData.year, lunarMonth, formData.day, isLeap); \r\n    solarDate = { year: lunarDate.yi, month: lunarDate.mi, day: lunarDate.dz };\r\n  } else {\r\n    solarDate =  { year: formData.year, month: formData.month, day: formData.day }; // 公历下直接使用原月份值\r\n  }\r\n  //经纬度\r\n  const selectedCity = cities.find(c => c.name === formData.city);\r\n  if (!selectedCity) {\r\n    alert('请选择有效的城市信息');\r\n    return;\r\n  }\r\n  const J = selectedCity.j;\r\n  const W = selectedCity.w;\r\n  //八字排盘\r\n  const eightCharacters = window.p.fatemaps(\r\n    genders,\r\n    solarDate.year,\r\n    solarDate.month,\r\n    solarDate.day,\r\n    parseInt(formData.hour),\r\n    parseInt(formData.minute),\r\n    0,\r\n    J,\r\n    W\r\n  );\r\n  // console.log('八字：', eightCharacters.sz);\r\n  // console.log('八字：', eightCharacters);\r\n  // console.log('八字：', eightCharacters.sz);\r\n  \r\n  const transformUserData = (raw) => {\r\n    let txt = \"\";\r\n    // 生成八字信息\r\n    txt += \"八字：\\n\";\r\n    txt += raw.sz.join(', ') + \"\\n\";\r\n    // 生成性别信息\r\n    txt += \"性别：\" + raw.xb + \"\\n\";\r\n    // 生成大运信息\r\n    txt += \"大运：\\n\";\r\n    for (let x in raw['dy']) {\r\n      let a = raw['dy'][x];\r\n      txt += `${a['zqage']}~${a['zboz']}岁\\t${a['zfma']}${a['zfmb']}\\n`;\r\n    }\r\n    return txt; // 确保函数返回生成的文本\r\n  };\r\n  const eightCharacter = transformUserData(eightCharacters);\r\n  // console.log(eightCharacter);\r\n  const datetimeStr = [\r\n    formData.name,\r\n    solarDate.year,\r\n    solarDate.month,\r\n    solarDate.day,\r\n    `${parseInt(formData.hour)}:${parseInt(formData.minute).toString().padStart(2, '0')}`\r\n  ].join('/');\r\n  console.log(datetimeStr);\r\n  onSubmit(datetimeStr, eightCharacter); // 确保父组件传递了onSubmit\r\n};\r\n\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className={styles.formContainer}>\r\n      {/* 姓名行 */}\r\n      <div className={styles.formRow}>\r\n        <div className={styles.inputGroup}>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"请输入您的姓名（选填）\"\r\n            className={styles.underlineInput}\r\n            value={formData.name}\r\n            onChange={(e) => setFormData({...formData, name: e.target.value})}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* 性别和历法选择行 */}\r\n      <div className={styles.formRow}>\r\n        <div className={styles.buttonGroup}>\r\n          {['男', '女'].map((gender) => (\r\n            <button\r\n              key={gender}\r\n              type=\"button\"\r\n              className={`${styles.choiceButton} ${\r\n                formData.gender === gender ? styles.active : ''\r\n              }`}\r\n              onClick={() => setFormData({...formData, gender})}\r\n            >\r\n              {gender}\r\n            </button>\r\n          ))}\r\n        </div>\r\n        <div className={styles.buttonGroup}>\r\n          {['公历', '农历'].map((type) => (\r\n            <button\r\n              key={type}\r\n              type=\"button\"\r\n              className={`${styles.choiceButton} ${\r\n                formData.calendarType === type ? styles.active : ''\r\n              }`}\r\n              onClick={() => setFormData({...formData, calendarType: type})}\r\n            >\r\n              {type}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* 出生日期选择行 */}\r\n      <div className={styles.formRow1}>\r\n        <div className={styles.dateSelectGroup}>\r\n        <select \r\n            value={formData.year}\r\n            onChange={(e) => setFormData({...formData, year: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            <option value=\"\">年</option>\r\n            {years.map((year) => (\r\n              <option key={year} value={year}>{year}</option>\r\n            ))}\r\n          </select>\r\n          <select\r\n            value={formData.month}\r\n            onChange={(e) => setFormData({...formData, month: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            <option value=\"\">月</option>\r\n            {updateMonthOptions().map((month, index) => (\r\n              <option key={index} value={month}>{month}</option>\r\n            ))}\r\n          </select>\r\n          <select\r\n            value={formData.day}\r\n            onChange={(e) => setFormData({...formData, day: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            <option value=\"\">日</option>\r\n            {days.map((day) => (\r\n              <option key={day} value={day}>{day}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 出生时间选择 */}\r\n      <div className={styles.formRow}>\r\n        <div className={styles.timeSelectGroup}>\r\n          <select\r\n            value={formData.hour}\r\n            onChange={(e) => setFormData({...formData, hour: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            {hours.map((hour) => (\r\n              <option key={hour} value={hour}>{hour}时</option>\r\n            ))}\r\n          </select>\r\n  \r\n          <select\r\n            value={formData.minute}\r\n            onChange={(e) => setFormData({...formData, minute: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            {minutes.map((minute) => (\r\n              <option key={minute} value={minute}>{minute}分</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n\r\n      {/* 省市联动选择行 */}\r\n    \r\n\r\n      <div className={styles.formRow3}>\r\n        <select\r\n          value={formData.province}\r\n          onChange={handleProvinceChange}\r\n          className={styles.underlineInput}\r\n          style={{ marginRight: '20px' }}\r\n        >\r\n          <option value=\"unknown\">选择省份</option>\r\n          {provinces.map(province => (\r\n            <option key={province.id} value={province.name}>{province.name}</option>\r\n          ))}\r\n        </select>\r\n\r\n        <select\r\n          value={formData.city}\r\n          onChange={handleCityChange}\r\n          className={styles.underlineInput}\r\n          disabled={!formData.province || formData.province === 'unknown'}\r\n        >\r\n          <option value=\"unknown\">\r\n            {formData.province === 'unknown' ? '先选择省份' : '选择城市'}\r\n          </option>\r\n          {filteredCities.map(city => (\r\n            <option key={city.id} value={city.name}>{city.name}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n          \r\n\r\n\r\n\r\n      {/* 排盘按钮行 */}\r\n      <div className={styles.formRow}>\r\n        <button type=\"submit\" className={styles.submitButton}>\r\n          立即解锁命盘玄机\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default Form;","// src/components/PaymentModal.jsx\r\nimport React, { useEffect, useState } from 'react';\r\nimport { QRCodeSVG } from 'qrcode.react'; \r\nimport PropTypes from 'prop-types';\r\n\r\nconst PaymentModal = ({ isOpen, qrcodeUrl, onClose }) => {\r\n  const [countdown, setCountdown] = useState(600); // 默认10分钟\r\n  // 倒计时效果\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n\r\n    const timer = setInterval(() => {\r\n      setCountdown(prev => Math.max(0, prev - 1));\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [isOpen]);\r\n\r\n  // 格式化时间显示\r\n  const formatTime = (seconds) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"payment-modal\">\r\n      <div className=\"modal-content\">\r\n        <div className=\"modal-header\">\r\n          <h3>扫码支付 ¥1.99</h3>\r\n          <button className=\"close-button\" onClick={onClose}>×</button>\r\n        </div>\r\n        \r\n        <div className=\"qrcode-wrapper\">\r\n          {qrcodeUrl ? (\r\n            <>\r\n              <QRCodeSVG \r\n                value={qrcodeUrl} \r\n                size={200}\r\n                fgColor=\"#2d3748\"\r\n                level=\"H\"\r\n              />\r\n              <p className=\"countdown\">剩余时间: {formatTime(countdown)}</p>\r\n            </>\r\n          ) : (\r\n            <div className=\"loading\">正在生成支付码...</div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"modal-footer\">\r\n          <p>请保存二维码，使用支付宝扫描完成支付</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nPaymentModal.propTypes = {\r\n  isOpen: PropTypes.bool.isRequired,\r\n  qrcodeUrl: PropTypes.string,\r\n  onClose: PropTypes.func.isRequired\r\n};\r\n\r\nexport default PaymentModal;\r\n","import ReactMarkdown from \"react-markdown\";\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport html2canvas from 'html2canvas';\r\n\r\n\r\nconst ANALYSIS_TYPES = [ \r\n  { id: 'health', name: '健康分析', icon: '❤️', color: '#ED7D31' },\r\n  { id: 'career', name: '事业分析', icon: '💼', color: '#005293' },\r\n  { id: 'wealth', name: '财运分析', icon: '💰', color: '#8064A6' },\r\n  { id: 'marriage', name: '婚姻分析', icon: '💍', color: '#A3CE27' }\r\n];\r\n\r\nconst AnalysisSection = ({ preview, unlocked, contents, onUnlock, onGoBack, onComplete }) => {\r\n  const [displayContent, setDisplayContent] = useState('');\r\n  const [blurContent, setBlurContent] = useState('');\r\n  const [selectedType, setSelectedType] = useState(null);\r\n  const [loadingType, setLoadingType] = useState(null);\r\n  const contentRef = useRef(null);\r\n \r\n  const [isShared, setIsShared] = useState(false);\r\n  const [isCopied, setIsCopied] = useState(false);\r\n\r\n  // 修改分享处理函数\r\n  const handleShare = async () => {\r\n    try {\r\n      // 先执行复制操作\r\n      await navigator.clipboard.writeText(window.location.href);\r\n      setIsCopied(true);\r\n      \r\n      // 显示提示2秒后弹出确认对话框\r\n      setTimeout(async () => {\r\n        const hasShared = await window.confirm(\r\n          '链接已复制！\\n\\n请将链接分享到社交平台\\n是否已完成分享？'\r\n        );\r\n        if (hasShared) {\r\n          setIsShared(true);\r\n        }\r\n      }, 1000);\r\n  \r\n      // 隐藏复制成功提示\r\n      setTimeout(() => setIsCopied(false), 3000);\r\n    } catch (err) {\r\n      alert('请手动复制地址栏链接');\r\n      setTimeout(async () => {\r\n        const hasShared = await window.confirm(\r\n          '请将链接分享到社交平台\\n是否已完成分享？'\r\n        );\r\n        if (hasShared) {\r\n          setIsShared(true);\r\n        }\r\n      }, 1000);\r\n  \r\n    }\r\n  };\r\n  \r\n  const watermarkImage = new Image();\r\n  watermarkImage.src = '/qrcode.png'; // 准备二维码图片\r\n  \r\n  const handleScreenshot = async () => {\r\n    try {\r\n      // 第一步：捕获原始内容\r\n      const canvas = await html2canvas(contentRef.current, {\r\n        useCORS: true,\r\n        allowTaint: true,\r\n        logging: false,\r\n      });\r\n  \r\n      // 第二步：创建水印画布\r\n      const watermarkCanvas = document.createElement('canvas');\r\n      const ctx = watermarkCanvas.getContext('2d');\r\n      \r\n      // 设置画布尺寸\r\n      watermarkCanvas.width = canvas.width;\r\n      watermarkCanvas.height = canvas.height;\r\n  \r\n      // 第三步：绘制原始内容\r\n      ctx.drawImage(canvas, 0, 0);\r\n      \r\n      // === 新增：添加文字抬头 ===\r\n      ctx.fillStyle = '#FF0000'; // 文字颜色\r\n      ctx.font = 'bold 48px Microsoft YaHei'; // 字体样式\r\n      ctx.textAlign = 'center'; // 水平居中\r\n      ctx.textBaseline = 'top'; // 垂直对齐从顶部开始\r\n      ctx.fillText('🌟 本报告由深智AI命理引擎生成 | www.mingli.xin', canvas.width / 2, 30);\r\n\r\n      // 二维码水印（右下角）\r\n      ctx.globalAlpha = 0.8;\r\n      ctx.drawImage(\r\n        watermarkImage,\r\n        canvas.width - 300, // x坐标不变，右边距150\r\n        100, // y坐标改为30，顶部边距30\r\n        284,\r\n        318\r\n        );\r\n  \r\n      // 第五步：生成最终图片\r\n      const finalUrl = watermarkCanvas.toDataURL('image/png');\r\n  \r\n      // 第六步：触发下载\r\n      const link = document.createElement('a');\r\n      link.href = finalUrl;\r\n      link.download = `命理分析报告_${new Date().toLocaleDateString()}.png`;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n  \r\n    } catch (error) {\r\n      console.error('截图失败:', error);\r\n      alert('生成报告失败，请稍后重试');\r\n    }\r\n  };\r\n  \r\n  // 内容分割逻辑优化\r\n  useEffect(() => {\r\n    if (typeof preview === 'string' && preview.length > 0) {\r\n      const splitIndex = Math.floor(preview.length * 0.9);\r\n      setDisplayContent(preview.slice(0, splitIndex));\r\n      setBlurContent(preview.slice(splitIndex));\r\n    }\r\n  }, [preview]);\r\n\r\n  // 处理模块解锁\r\n  const handleUnlock = async (typeId) => {\r\n    if (unlocked[typeId] || loadingType) return;\r\n    \r\n    try {\r\n      setLoadingType(typeId);\r\n      await onUnlock(typeId);\r\n      setSelectedType(typeId); // 解锁后自动选中\r\n    } catch (error) {\r\n      console.error('解锁失败:', error);\r\n    } finally {\r\n      setLoadingType(null);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"analysis-container\"\r\n    ref={contentRef}  // 关键绑定\r\n    >\r\n\r\n      <h2>基础命理分析</h2>\r\n\r\n      {!onComplete ? (\r\n        <ReactMarkdown>{preview}</ReactMarkdown>\r\n      ) : (\r\n        <div className=\"preview-section\">\r\n          <ReactMarkdown>{displayContent}</ReactMarkdown>\r\n          {blurContent && (\r\n            <div className={`blur-section ${(selectedType || isShared) ? 'unlocked' : 'locked'}`}>\r\n              <ReactMarkdown>{blurContent}</ReactMarkdown>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {onComplete && (\r\n        <>\r\n    <div className=\"share-section\">\r\n      {!(selectedType || isShared) && (\r\n        <div className=\"share-container\">\r\n          <button \r\n            onClick={handleShare}\r\n            className=\"share-trigger\"\r\n          >\r\n            🔗 复制链接分享解锁\r\n          </button>\r\n          <span className=\"tooltip\">分享给微信好友即可查看完整解析</span>\r\n        </div>\r\n      )}\r\n      \r\n      {isCopied && (\r\n        <div className=\"copied-notice\">\r\n          ✅ 链接已复制到剪贴板！\r\n        </div>\r\n              )}\r\n        </div>\r\n                  \r\n\r\n          {/* 分析模块布局 */}  \r\n          <div className=\"analysis-modules\">\r\n            {ANALYSIS_TYPES.map((type) => (\r\n              <div\r\n                key={type.id}\r\n                className={`analysis-module ${\r\n                  unlocked[type.id] ? 'unlocked' : 'locked'\r\n                } ${selectedType === type.id ? 'active' : ''}`}\r\n                style={{ backgroundColor: type.color }}\r\n                onClick={() => {\r\n                  if (unlocked[type.id]) {\r\n                    setSelectedType(type.id);\r\n                  } else {\r\n                    handleUnlock(type.id);\r\n                  }\r\n                }}\r\n              >\r\n                <div className=\"module-header\">\r\n                <span className=\"icon\">{type.icon}</span>\r\n                <h3>{type.name}</h3>\r\n                </div>  \r\n                <div className=\"module-status\">\r\n                  {loadingType === type.id ? (\r\n                    <div className=\"loader\" />\r\n                  ) : unlocked[type.id] ? (\r\n                    contents[type.id] ? '✓ 已解锁' : <div className=\"loader\" />\r\n                  ) : (\r\n                    '￥1.99解锁'\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* 详细分析内容展示 */}\r\n          {selectedType && unlocked[selectedType] && (\r\n            <div className=\"detail-content\">\r\n              <ReactMarkdown>{contents[selectedType]}</ReactMarkdown>\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n      <button className=\"action-button back\" onClick={onGoBack}>\r\n        ← 返回主页\r\n      </button>\r\n      <button className=\"action-button screenshot\" onClick={handleScreenshot}>\r\n        📸 截图保存\r\n      </button>\r\n\r\n<div className=\"disclaimer\">\r\n<p>※ 本分析由AI生成，仅供娱乐参考，不作为决策依据</p>\r\n<p>※ 根据相关法规，所有数据将在24小时后自动删除</p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AnalysisSection;\r\n","// const BASE_URL = process.env.NODE_ENV === 'development' \r\n//   ? 'http://localhost:5000' \r\n//   : 'http://8.133.207.19:5000';\r\n\r\nconst BASE_URL =\"http://8.133.207.19:5000\"\r\n\r\nconst MAX_RETRIES = 3;\r\nconst RETRY_DELAY = 2000;\r\n\r\nconst createEventSourceWithRetry = (url, handlers) => {\r\n  const es = new EventSource(url);\r\n  let retryCount = 0;\r\n  let isConnected = false;\r\n\r\n  es.onopen = () => {\r\n    console.log('SSE连接已建立');\r\n    isConnected = true;\r\n    retryCount = 0;\r\n  };\r\n\r\n  es.onerror = (err) => {\r\n    if (!isConnected && retryCount < MAX_RETRIES) {\r\n      console.log(`SSE连接失败,${RETRY_DELAY/1000}秒后第${retryCount + 1}次重试...`);\r\n      retryCount++;\r\n      // 不创建新的EventSource实例，而是等待现有实例自动重连\r\n      // 浏览器内置的EventSource会自动重试连接\r\n    } else if (!isConnected) {\r\n      handlers.onError?.('连接已断开,请刷新页面重试');\r\n      es.close();\r\n    }\r\n  };\r\n\r\n  return es;\r\n};\r\n\r\nexport const createOrderStream = (eightCharacters, handlers) => {\r\n  const url = `${BASE_URL}/api/orders/stream?eightCharacters=${encodeURIComponent(eightCharacters)}`;\r\n  const es = createEventSourceWithRetry(url, handlers);\r\n\r\n  es.addEventListener('stream', (e) => {\r\n    const data = JSON.parse(e.data);\r\n    handlers.onStream?.(data.content);\r\n  });\r\n\r\n  es.addEventListener('stream_end', (e) => {\r\n    const data = JSON.parse(e.data);\r\n    handlers.onComplete?.(data.orderId);\r\n    es.close();\r\n  });\r\n\r\n  es.addEventListener('error', (e) => {\r\n    if(e.data) {\r\n      const data = JSON.parse(e.data);\r\n      handlers.onError?.(data.message);\r\n      es.close();\r\n    }\r\n  });\r\n\r\n  return es;\r\n};\r\n\r\nexport const initiatePayment = (prevOrderId, analysisType, handlers) => {\r\n  const url = `${BASE_URL}/api/orders/${prevOrderId}/payment?type=${analysisType}`;\r\n  const es = createEventSourceWithRetry(url, handlers);\r\n\r\n  es.addEventListener('payment', (e) => {\r\n    const data = JSON.parse(e.data);\r\n    handlers.onPaymentQR?.(data.qrcodeUrl, data.orderId);\r\n  });\r\n\r\n  es.addEventListener('payment_success', (e) => {\r\n    handlers.onPaymentstatus?.();\r\n  });\r\n\r\n  es.addEventListener('stream', (e) => {\r\n    const data = JSON.parse(e.data);\r\n    handlers.onAnalysisChunk?.(data.content);\r\n  });\r\n\r\n  es.addEventListener('stream_end', () => {\r\n    handlers.onAnalysisEnd?.();\r\n    es.close();\r\n  });\r\n\r\n  es.addEventListener('error', (e) => {\r\n    if(e.data) {\r\n      const data = JSON.parse(e.data);\r\n      handlers.onError?.(data.message);\r\n      es.close();\r\n    }\r\n  });\r\n\r\n  return es;\r\n};","import React, { useState, useEffect } from 'react';\nimport Form from './components/Form';\nimport PaymentModal from './components/PaymentModal';\nimport AnalysisSection from './components/AnalysisSection';\nimport './App.css';\nimport { createOrderStream, initiatePayment } from './api';\n\nconst ANALYSIS_TYPES = [\n  { id: 'health', name: '健康分析' },\n  { id: 'career', name: '事业分析' },\n  { id: 'wealth', name: '财运分析' },\n  { id: 'marriage', name: '婚姻分析' }\n];\n\nfunction App() {\n  const [analysisData, setAnalysisData] = useState({\n    currentOrderId: null,\n    preview: '',\n    unlocked: {},\n    contents: {\n      health: null,\n      career: null,\n      wealth: null,\n      marriage: null\n    }\n  });\n  const [paymentState, setPaymentState] = useState({\n    show: false,\n    qrcodeUrl: '',\n    processingType: null\n  });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [es, setES] = useState(null);\n\n  // 新增函数：将分析数据保存到本地存储\n  const saveAnalysisToLocalStorage = (data) => {\n    // 确保data是一个有效的对象\n    if (typeof data !== 'object' || data === null) {\n      console.error('无法保存无效的分析数据:', data);\n      return;\n    }\n  \n    try {\n      localStorage.setItem('analysisData', JSON.stringify(data));\n    } catch (error) {\n      console.error('保存分析数据到本地存储失败:', error);\n    }\n  };\n  \n  // 新增函数：从本地存储加载分析数据\n  const loadAnalysisFromLocalStorage = () => {\n    // console.log('开始从本地存储加载分析数据');\n    const data = localStorage.getItem('analysisData');\n    // console.log('从本地存储获取的数据:', data);\n    if (data) {\n      try {\n        const parsedData = JSON.parse(data);\n        // console.log('解析后的分析数据:', parsedData);\n  \n        // 确保数据格式正确\n        if (\n          typeof parsedData === 'object' &&\n          parsedData !== null &&\n          typeof parsedData.preview === 'string' &&\n          typeof parsedData.unlocked === 'object' &&\n          typeof parsedData.contents === 'object'\n        ) {\n          return parsedData;\n        } else {\n          console.error('本地存储中的分析数据格式不正确');\n          return null;\n        }\n      } catch (error) {\n        console.error('解析本地存储中的分析数据失败:', error);\n        return null;\n      }\n    }\n    return null;\n  };\n\n  const clearAnalysisData = () => {\n    try {\n      localStorage.removeItem('analysisData');\n      setAnalysisData({\n        currentOrderId: null,\n        preview: '',\n        unlocked: {},\n        contents: { health: '', career: '', wealth: '', marriage: '' }\n      });\n    } catch (error) {\n      console.error('清除分析数据失败:', error);\n    }\n  };\n  \n  const handleSubmit = async (datatime, eightCharacters) => {\n    setLoading(true);\n    setError('');\n    setAnalysisData({\n      preview: '',\n      unlocked: {},\n      contents: { health: '', career: '', wealth: '', marriage: '' }\n    });\n\n    const newES = createOrderStream(eightCharacters, {\n      onStream: (chunk) => {\n        setAnalysisData(prev => ({\n          ...prev,\n          preview: prev.preview + chunk\n        }));\n        setLoading(false);\n      },\n      onComplete: (prevOrderId) => {\n        setAnalysisData(prev => ({\n          ...prev,\n          currentOrderId: prevOrderId\n        }));\n      },\n      onError: (message) => {\n        setError(message || '生成预览失败');\n        setLoading(false);\n      }\n    });\n    setES(newES);\n  };\n  const unlockAnalysis = (type) => {\n    if (!analysisData.currentOrderId) return;\n    console.log(\"选择分析\",type)\n    setPaymentState({\n      show: true,\n      qrcodeUrl: '',\n      processingType: type\n    });\n\n    const paymentES = initiatePayment(analysisData.currentOrderId, type, {\n      onPaymentQR: (qrcodeUrl, orderId) => {\n        setPaymentState(prev => ({ ...prev, qrcodeUrl }));\n    \n      },\n      onAnalysisChunk: (chunk) => {\n        setAnalysisData(prev => ({\n          ...prev,\n          contents: {\n            ...prev.contents,\n            [type]: (prev.contents[type] || '') + chunk\n          }\n        }));\n      },\n       \n      \n      onPaymentstatus: () => {\n        setAnalysisData(prev => ({\n          ...prev,\n          unlocked: { ...prev.unlocked, [type]: true }\n        }));\n        setPaymentState({ show: false, qrcodeUrl: '', processingType: null });\n      },\n\n      onAnalysisEnd: () => {\n      },\n\n      onError: (message) => {\n        setError(message || '支付流程出错');\n        setPaymentState({ show: false, qrcodeUrl: '', processingType: null });\n      }\n    });\n\n    setES(paymentES);\n  };\n\n  useEffect(() => {\n    if (analysisData.preview) { // 仅在非空时执行\n      saveAnalysisToLocalStorage(analysisData);\n    }\n  }, [analysisData]); \n  \n\n\n  useEffect(() => {\n    // 从本地存储加载分析数据\n    const loadedData = loadAnalysisFromLocalStorage();\n    if (loadedData) {\n      setAnalysisData(loadedData);\n    }\n    return () => es?.close();\n  }, [es]);\n\n\n  return (\n    <div className=\"App\">\n      <header className=\"header\">\n        <div className=\"header-content\">\n          <div className=\"branding\">\n            <h1>MingLi理命</h1>\n            <p className=\"slogan\">一阴一阳之谓道</p>\n          </div>\n          <div className=\"logo-container\">\n            <img src=\"/logo.png\" alt=\"Logo\" className=\"logo\" />\n          </div>\n        </div>\n      </header>\n\n        {error && <div className=\"error-message\">{error}</div>}\n        \n        {loading ? (\n            <div className=\"loading-wrapper\">\n            <div className=\"loading\">\n              ⏳ 深度分析通常需要 1~2 分钟\n              <div className=\"sub-hint\">（期间请不要刷新页面）</div>\n            </div>\n          </div>\n        ) : (\n          !analysisData.preview ? (\n            <Form onSubmit={handleSubmit} />\n          ) : (\n            <AnalysisSection \n              preview={analysisData.preview}\n              unlocked={analysisData.unlocked}\n              contents={analysisData.contents}\n              onUnlock={unlockAnalysis}\n              analysisTypes={ANALYSIS_TYPES}\n              onGoBack={clearAnalysisData}\n              onComplete={analysisData.currentOrderId}\n            />\n          )\n        )}\n\n        <PaymentModal\n          isOpen={paymentState.show}\n          qrcodeUrl={paymentState?.qrcodeUrl}\n          onClose={() => setPaymentState({ show: false, qrcode: '', processingType: null })}\n        />\n    \n      <footer>\n        <div className=\"sfooterContent\">\n          <p className=\"sdisclaimer\">\n            拒绝向未成年人提供服务，仅供娱乐和参考。\n          </p>\n          <p className=\"sdisclaimer\">\n          ©2025 MingLi理命\n          </p>\n        </div>\n      </footer>\n\n    </div>\n    \n  );\n}\n\nexport default App;\n\n\n\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}