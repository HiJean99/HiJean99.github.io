{"version":3,"sources":["components/Form.module.css","components/Form.js","components/PaymentModal.js","components/AnalysisSection.js","api.js","App.js","reportWebVitals.js","index.js"],"names":["module","exports","Form","_ref","onSubmit","formData","setFormData","useState","name","gender","calendarType","year","month","day","hour","minute","province","city","years","Array","from","length","_","i","days","hours","toString","padStart","minutes","provinces","citydata","filter","item","pid","cities","filteredCities","selectedProvince","find","prov","id","_jsxs","e","preventDefault","alert","genders","solarDate","lunarMonth","isLeap","startsWith","lunarDate","window","p","Lunar2Solar","selectedCity","c","J","j","W","w","eightCharacter","transformUserData","raw","datetimeStr","txt","sz","join","xb","dyItems","Object","keys","a","push","fatemaps","parseInt","className","styles","formContainer","children","_jsx","formRow","inputGroup","type","placeholder","underlineInput","value","onChange","target","buttonGroup","map","choiceButton","active","onClick","formRow1","dateSelectGroup","dateSelect","index","timeSelectGroup","formRow3","style","marginRight","disabled","submitButton","PaymentModal","isOpen","qrcodeUrl","onClose","expiresAt","price","calculateInitialCountdown","useCallback","Math","max","floor","Date","now","countdown","setCountdown","useEffect","timer","setInterval","prev","clearInterval","_Fragment","QRCodeSVG","size","fgColor","level","color","seconds","ANALYSIS_TYPES","icon","AnalysisSection","_ANALYSIS_TYPES$find","preview","unlocked","contents","onUnlock","onGoBack","onComplete","generating","onResetLoadingType","displayContent","setDisplayContent","blurContent","setBlurContent","selectedType","setSelectedType","loadingType","setLoadingType","isShared","setIsShared","isCopied","setIsCopied","error","setError","analysisProgress","setAnalysisProgress","health","career","wealth","marriage","generatingTypes","setGeneratingTypes","progressIntervals","useRef","contentUpdateRef","handleUnlock","async","typeId","handleTypeSelection","contentRef","watermarkImage","Image","current","src","typesToUpdate","forEach","newProgress","newGenerating","includes","currentProgressIntervals","values","interval","entries","_ref2","isGenerating","prevProgress","currentProgress","min","splitIndex","slice","ref","ReactMarkdown","navigator","clipboard","writeText","location","href","setTimeout","confirm","err","backgroundColor","width","Error","canvas","html2canvas","useCORS","allowTaint","logging","watermarkCanvas","document","createElement","ctx","getContext","height","drawImage","fillStyle","font","textAlign","textBaseline","fillText","complete","globalAlpha","finalUrl","toDataURL","fileName","toLocaleDateString","link","download","body","appendChild","click","removeChild","propsAreEqual","prevProps","nextProps","JSON","stringify","React","memo","BASE_URL","createEventSourceWithRetry","url","handlers","es","maxRetries","arguments","undefined","retryCount","connect","EventSource","onopen","onerror","_handlers$onError","close","onError","call","App","analysisData","setAnalysisData","currentOrderId","analysisOrderIds","paymentInfo","paymentState","setPaymentState","show","processingType","loading","setLoading","connections","setConnections","main","progress","setProgress","resetLoadingTypeCallback","setResetLoadingTypeCallback","closeConnection","closeAllConnections","storage","useMemo","save","data","localStorage","setItem","load","getItem","parsedData","parse","removeItem","savePaymentInfo","key","console","loadPaymentInfo","initialAnalysisState","setupPaymentConnection","paymentES","initiatePayment","prevOrderId","analysisType","safeParseJson","defaultValue","_handlers$onError6","addEventListener","_handlers$onPaymentQR","Price","onPaymentQR","_handlers$onPaymentst","onPaymentstatus","_handlers$onAlreadyPa","content","onAlreadyPaid","_handlers$onTryAgain","onTryAgain","_handlers$onAnalysisC","onAnalysisChunk","_handlers$onAnalysisE","onAnalysisEnd","_handlers$onError7","_handlers$onError8","message","orderId","createdAt","chunk","loadedData","alt","Promise","resolve","existingPayment","analysisTypes","clearAnalysisData","callback","progressInterval","newES","createOrderStream","eightCharacters","encodeURIComponent","_handlers$onStream","onStream","_handlers$onError2","_handlers$onComplete","_handlers$onError3","_handlers$onError4","_handlers$onError5","handleClosePaymentModal","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","createRoot","getElementById","render","StrictMode"],"mappings":"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","file":"static/js/main.6269fcfe.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"formContainer\":\"Form_formContainer__30bom\",\"formRow\":\"Form_formRow__3daMv\",\"formRow1\":\"Form_formRow1__XS48M\",\"formRow3\":\"Form_formRow3__3AhXh\",\"inputGroup\":\"Form_inputGroup__EaPaw\",\"underlineInput\":\"Form_underlineInput__1EWfm\",\"optional\":\"Form_optional__5hbdU\",\"buttonGroup\":\"Form_buttonGroup__7LocG\",\"choiceButton\":\"Form_choiceButton__MMaii\",\"active\":\"Form_active__TTwYc\",\"dateSelectGroup\":\"Form_dateSelectGroup__32CjE\",\"dateSelect\":\"Form_dateSelect__3YUVx\",\"timeSelectGroup\":\"Form_timeSelectGroup__3IR3b\",\"underlineSelect\":\"Form_underlineSelect__1jtox\",\"citySelect\":\"Form_citySelect__3SZdv\",\"submitButton\":\"Form_submitButton__1NJMU\"};","import React, { useState } from 'react';\r\nimport styles from './Form.module.css';\r\nimport citydata from \"./city.json\"\r\n\r\nconst Form = ({ onSubmit }) => {\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    gender: '男', // 设置默认值\r\n    calendarType: '公历', // 设置默认值\r\n    year: '',\r\n    month: '',\r\n    day: '',\r\n    hour: '00',\r\n    minute: '00',\r\n    province: '',\r\n    city: ''\r\n  });\r\n\r\n  // 生成年份选项（1900-2050）\r\n  const years = Array.from({length: 151}, (_, i) => 1900 + i);\r\n  // const months = Array.from({length: 12}, (_, i) => i + 1);\r\n  const days = Array.from({length: 31}, (_, i) => i + 1);\r\n  // 农历月份选项，包括可能的闰月\r\n  const updateMonthOptions = () => {\r\n    if (formData.calendarType === '农历') {\r\n      return [\r\n        '正月', '二月', '三月', '四月', '五月', '六月',\r\n        '七月', '八月', '九月', '十月', '十一月', '十二月',\r\n        '闰正月', '闰二月', '闰三月', '闰四月', '闰五月', '闰六月',\r\n        '闰七月', '闰八月', '闰九月', '闰十月', '闰十一月', '闰十二月'\r\n      ];\r\n    }\r\n    return Array.from({length: 12}, (_, i) => i + 1);\r\n  };\r\n  \r\n  // 生成时间选项\r\n  const hours = Array.from({length: 24}, (_, i) => i.toString().padStart(2, '0'));\r\n  const minutes = Array.from({length: 60}, (_, i) => i.toString().padStart(2, '0'));\r\n  //设置省份、城市规则\r\n  const provinces = citydata.city.filter(item => item.pid === 0);\r\n  const cities = citydata.city.filter(item => item.pid !== 0);\r\n\r\n  const handleProvinceChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      province: e.target.value,\r\n      city: 'unknown'\r\n    });\r\n  };\r\n\r\n  const handleCityChange = (e) => {\r\n    setFormData({ ...formData, city: e.target.value });\r\n  };\r\n\r\n  const filteredCities = cities.filter(city => {\r\n    const selectedProvince = provinces.find(prov => prov.name === formData.province);\r\n    return selectedProvince && city.pid === selectedProvince.id;\r\n  });\r\n  \r\n\r\n// 确保在组件顶部定义了handleSubmit函数\r\nconst handleSubmit = (e) => {\r\n  e.preventDefault(); // 必须阻止默认行为\r\n  // console.log('提交数据：', formData);\r\n  \r\n  // 添加基础验证\r\n  if (!formData.year || !formData.month || !formData.day) {\r\n    alert('请选择完整的出生日期');\r\n    return;\r\n  }\r\n  if (formData.province === 'unknown' || formData.city === 'unknown') {\r\n    alert('请选择完整的地区信息');\r\n    return;\r\n  }\r\n\r\n  //性别判断\r\n  let genders\r\n  if (formData.gender === '男') { \r\n    genders = 0;\r\n  }else {\r\n      genders = 1;\r\n    }\r\n  //农历转公历\r\n  // 月份映射表\r\n  const monthMap = {\r\n    '正月': 1, '二月': 2, '三月': 3, '四月': 4, '五月': 5, '六月': 6,\r\n    '七月': 7, '八月': 8, '九月': 9, '十月': 10, '十一月': 11, '十二月': 12,\r\n    '闰正月': 1, '闰二月': 2, '闰三月': 3, '闰四月': 4, '闰五月': 5, '闰六月': 6,\r\n    '闰七月': 7, '闰八月': 8, '闰九月': 9, '闰十月': 10, '闰十一月': 11, '闰十二月': 12\r\n  };\r\n\r\n  let solarDate;\r\n  let lunarMonth = monthMap[formData.month]; \r\n  let isLeap = false;\r\n  if (formData.calendarType === '农历') {\r\n    // console.log('确定农历日期：', formData.year, lunarMonth, formData.day);\r\n    if (formData.month.startsWith('闰')) {\r\n      isLeap = true;\r\n    }\r\n    const lunarDate = window.p.Lunar2Solar(formData.year, lunarMonth, formData.day, isLeap);\r\n    // console.log('转换后的公历日期：', lunarDate);\r\n    if (lunarDate === false) {\r\n      alert('请检查农历日期是否正确');\r\n      return;\r\n    }\r\n    solarDate = { year: lunarDate[0], month: lunarDate[1], day: lunarDate[2] };\r\n    \r\n    // console.log('转换后的公历日期：', solarDate);\r\n  } else {\r\n    solarDate =  { year: formData.year, month: formData.month, day: formData.day }; // 公历下直接使用原月份值\r\n  }\r\n  //经纬度\r\n  const selectedCity = cities.find(c => c.name === formData.city);\r\n  if (!selectedCity) {\r\n    alert('请选择有效的城市信息');\r\n    return;\r\n  }\r\n  const J = selectedCity.j;\r\n  const W = selectedCity.w;\r\n  //八字排盘\r\n  const eightCharacters = window.p.fatemaps(\r\n    genders,\r\n    solarDate.year,\r\n    solarDate.month,\r\n    solarDate.day,\r\n    parseInt(formData.hour),\r\n    parseInt(formData.minute),\r\n    0,\r\n    J,\r\n    W\r\n  );\r\n \r\n  const transformUserData = (raw, datetimeStr) => {\r\n    let txt = \"\";\r\n    // 生成八字信息\r\n      // 添加出生时间信息\r\n    txt += \"出生时间：\" + datetimeStr + \"\\n\";\r\n    txt += \"八字：\";\r\n    txt += raw.sz.join(', ') + \"\\n\";\r\n    // 生成性别信息\r\n    txt += \"性别：\" + raw.xb + \"\\n\";\r\n    // 生成大运信息\r\n    txt += \"大运：\";\r\n    let dyItems = [];\r\n    // 限制遍历5次\r\n    for (let i = 0; i < 7 && raw['dy'] && i < Object.keys(raw['dy']).length; i++) {\r\n      let a = raw['dy'][i];\r\n      dyItems.push(`${a['zfma']}${a['zfmb']}`);\r\n    }\r\n    txt += dyItems.length > 0 ? dyItems.join(', ') + \"\\n\" : \"无大运数据\\n\";\r\n    return txt; // 确保函数返回生成的文本\r\n  };\r\n  \r\n  // console.log(eightCharacter);\r\n  const datetimeStr = [\r\n    formData.name,\r\n    solarDate.year,\r\n    solarDate.month,\r\n    solarDate.day,\r\n    `${parseInt(formData.hour)}:${parseInt(formData.minute).toString().padStart(2, '0')}`\r\n  ].join('/');\r\n  const eightCharacter = transformUserData(eightCharacters,datetimeStr);\r\n  // console.log(eightCharacter);\r\n  onSubmit( eightCharacter); // 确保父组件传递了onSubmit\r\n};\r\n\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className={styles.formContainer}>\r\n      {/* 姓名行 */}\r\n      <div className={styles.formRow}>\r\n        <div className={styles.inputGroup}>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"请输入您的姓名（选填）\"\r\n            className={styles.underlineInput}\r\n            value={formData.name}\r\n            onChange={(e) => setFormData({...formData, name: e.target.value})}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* 性别和历法选择行 */}\r\n      <div className={styles.formRow}>\r\n        <div className={styles.buttonGroup}>\r\n          {['男', '女'].map((gender) => (\r\n            <button\r\n              key={gender}\r\n              type=\"button\"\r\n              className={`${styles.choiceButton} ${\r\n                formData.gender === gender ? styles.active : ''\r\n              }`}\r\n              onClick={() => setFormData({...formData, gender})}\r\n            >\r\n              {gender}\r\n            </button>\r\n          ))}\r\n        </div>\r\n        <div className={styles.buttonGroup}>\r\n          {['公历', '农历'].map((type) => (\r\n            <button\r\n              key={type}\r\n              type=\"button\"\r\n              className={`${styles.choiceButton} ${\r\n                formData.calendarType === type ? styles.active : ''\r\n              }`}\r\n              onClick={() => setFormData({...formData, calendarType: type})}\r\n            >\r\n              {type}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* 出生日期选择行 */}\r\n      <div className={styles.formRow1}>\r\n        <div className={styles.dateSelectGroup}>\r\n        <select \r\n            value={formData.year}\r\n            onChange={(e) => setFormData({...formData, year: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            <option value=\"\">年</option>\r\n            {years.map((year) => (\r\n              <option key={year} value={year}>{year}</option>\r\n            ))}\r\n          </select>\r\n          <select\r\n            value={formData.month}\r\n            onChange={(e) => setFormData({...formData, month: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            <option value=\"\">月</option>\r\n            {updateMonthOptions().map((month, index) => (\r\n              <option key={index} value={month}>{month}</option>\r\n            ))}\r\n          </select>\r\n          <select\r\n            value={formData.day}\r\n            onChange={(e) => setFormData({...formData, day: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            <option value=\"\">日</option>\r\n            {days.map((day) => (\r\n              <option key={day} value={day}>{day}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 出生时间选择 */}\r\n      <div className={styles.formRow}>\r\n        <div className={styles.timeSelectGroup}>\r\n          <select\r\n            value={formData.hour}\r\n            onChange={(e) => setFormData({...formData, hour: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            {hours.map((hour) => (\r\n              <option key={hour} value={hour}>{hour}时</option>\r\n            ))}\r\n          </select>\r\n  \r\n          <select\r\n            value={formData.minute}\r\n            onChange={(e) => setFormData({...formData, minute: e.target.value})}\r\n            className={styles.dateSelect}\r\n          >\r\n            {minutes.map((minute) => (\r\n              <option key={minute} value={minute}>{minute}分</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 省市联动选择行 */}\r\n  \r\n      <div className={styles.formRow3}>\r\n        <select\r\n          value={formData.province}\r\n          onChange={handleProvinceChange}\r\n          className={styles.underlineInput}\r\n          style={{ marginRight: '20px' }}\r\n        >\r\n          <option value=\"unknown\">选择省份</option>\r\n          {provinces.map(province => (\r\n            <option key={province.id} value={province.name}>{province.name}</option>\r\n          ))}\r\n        </select>\r\n\r\n        <select\r\n          value={formData.city}\r\n          onChange={handleCityChange}\r\n          className={styles.underlineInput}\r\n          disabled={!formData.province || formData.province === 'unknown'}\r\n        >\r\n          <option value=\"unknown\">\r\n            {formData.province === 'unknown' ? '先选择省份' : '选择城市'}\r\n          </option>\r\n          {filteredCities.map(city => (\r\n            <option key={city.id} value={city.name}>{city.name}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n          \r\n\r\n      {/* 排盘按钮行 */}\r\n      <div className={styles.formRow}>\r\n        <button type=\"submit\" className={styles.submitButton}>\r\n          立即解锁命盘玄机\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default Form;","// src/components/PaymentModal.jsx\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport { QRCodeSVG } from 'qrcode.react'; \r\nimport PropTypes from 'prop-types';\r\nimport './PaymentModal.css';\r\n\r\nconst PaymentModal = ({ isOpen, qrcodeUrl, onClose, expiresAt, price = 0.99 }) => {\r\n  // 使用useCallback包装函数，防止它在每次渲染时都重新创建\r\n  const calculateInitialCountdown = useCallback(() => {\r\n    if (expiresAt) {\r\n      const remainingTime = Math.max(0, Math.floor((expiresAt - Date.now()) / 1000));\r\n      return remainingTime;\r\n    }\r\n    return 300; // 默认5分钟\r\n  }, [expiresAt]);\r\n  \r\n  const [countdown, setCountdown] = useState(calculateInitialCountdown());\r\n  \r\n  // 当模态框打开或expiresAt变化时重新计算倒计时\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setCountdown(calculateInitialCountdown());\r\n    }\r\n  }, [isOpen, calculateInitialCountdown]);\r\n\r\n  // 倒计时效果\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n\r\n    const timer = setInterval(() => {\r\n      setCountdown(prev => {\r\n        if (prev <= 0) {\r\n          clearInterval(timer);\r\n          return 0;\r\n        }\r\n        return prev - 1;\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [isOpen]);\r\n\r\n  // 格式化时间显示\r\n  const formatTime = (seconds) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"payment-modal\">\r\n      <div className=\"modal-content\">\r\n        <div className=\"modal-header\">\r\n          <h3>扫码支付 ¥{price}</h3>\r\n          <button className=\"close-button\" onClick={onClose}>×</button>\r\n        </div>\r\n        \r\n        <div className=\"qrcode-wrapper\">\r\n          {qrcodeUrl ? (\r\n            <>\r\n              <QRCodeSVG \r\n                value={qrcodeUrl} \r\n                size={200}\r\n                fgColor={countdown <= 0 ? \"#cccccc\" : \"#2d3748\"}\r\n                level=\"H\"\r\n              />\r\n              <p className=\"countdown\" style={{color: countdown <= 0 ? \"#ff0000\" : \"inherit\"}}>\r\n                {countdown <= 0 ? \"二维码已失效\" : `剩余时间: ${formatTime(countdown)}`}\r\n              </p>\r\n              {countdown <= 0 && (\r\n                <div className=\"expired-notice\">\r\n                  <p>二维码已过期，请关闭后重试</p>\r\n                  <button onClick={onClose} className=\"retry-button\">关闭重试</button>\r\n                </div>\r\n              )}\r\n            </>\r\n          ) : (\r\n            <div className=\"loading\">正在生成支付码...</div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"modal-footer\">\r\n          <p>请保存二维码，使用支付宝扫描完成支付</p>\r\n          <p className=\"no-refund-policy\">⚠️ <strong>付款须知</strong>：本服务为虚拟内容，支付后立即提供，因此付款后不予退款。请确认后再付款。</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nPaymentModal.propTypes = {\r\n  isOpen: PropTypes.bool.isRequired,\r\n  qrcodeUrl: PropTypes.string,\r\n  onClose: PropTypes.func.isRequired,\r\n  expiresAt: PropTypes.number,\r\n  price: PropTypes.number\r\n};\r\n\r\nexport default PaymentModal;\r\n","import ReactMarkdown from \"react-markdown\";\r\nimport React, { useRef, useEffect, useState, useCallback } from 'react';\r\nimport html2canvas from 'html2canvas';\r\nimport './AnalysisSection.css';\r\n\r\nconst ANALYSIS_TYPES = [ \r\n  { id: 'health', name: '健康分析', icon: '❤️', color: '#ED7D31' },\r\n  { id: 'career', name: '事业分析', icon: '💼', color: '#005293' },\r\n  { id: 'wealth', name: '财运分析', icon: '💰', color: '#8064A6' },\r\n  { id: 'marriage', name: '婚姻分析', icon: '💍', color: '#A3CE27' }\r\n];\r\n\r\nconst AnalysisSection = ({ preview, unlocked, contents, onUnlock, onGoBack, onComplete, generating, onResetLoadingType }) => {\r\n  const [displayContent, setDisplayContent] = useState('');\r\n  const [blurContent, setBlurContent] = useState('');\r\n  const [selectedType, setSelectedType] = useState(null);\r\n  const [loadingType, setLoadingType] = useState(null);\r\n  const [isShared, setIsShared] = useState(false);\r\n  const [isCopied, setIsCopied] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [analysisProgress, setAnalysisProgress] = useState({\r\n    health: 0,\r\n    career: 0,\r\n    wealth: 0,\r\n    marriage: 0\r\n  });\r\n  const [generatingTypes, setGeneratingTypes] = useState({\r\n    health: false,\r\n    career: false, \r\n    wealth: false,\r\n    marriage: false\r\n  });\r\n  const progressIntervals = useRef({});\r\n  const contentUpdateRef = useRef({\r\n    health: false,\r\n    career: false, \r\n    wealth: false,\r\n    marriage: false\r\n  });\r\n\r\n  // 添加一个副作用来监听外部重置loadingType的调用\r\n  useEffect(() => {\r\n    if (onResetLoadingType) {\r\n      onResetLoadingType(() => {\r\n        setLoadingType(null);\r\n      });\r\n    }\r\n  }, [onResetLoadingType]);\r\n\r\n  const handleUnlock = useCallback(async (typeId) => {\r\n    if (unlocked[typeId] || loadingType) return;\r\n    \r\n    try {\r\n      setLoadingType(typeId);\r\n      setError(''); // 清除可能存在的错误消息\r\n      \r\n      await onUnlock(typeId);\r\n      setSelectedType(typeId);\r\n    } catch (error) {\r\n      setError('解锁失败，请重试');\r\n      setLoadingType(null);\r\n    }\r\n  }, [unlocked, loadingType, onUnlock]);\r\n\r\n  const handleTypeSelection = useCallback((typeId) => {\r\n    if (unlocked[typeId]) {\r\n      // 已解锁的模块直接设置选中状态\r\n      setSelectedType(typeId);\r\n    } else if (!loadingType) {\r\n      // 确保没有其他模块正在加载时才尝试解锁\r\n      handleUnlock(typeId);\r\n    }\r\n  }, [unlocked, loadingType, handleUnlock]);\r\n  \r\n  const contentRef = useRef(null);\r\n  const watermarkImage = useRef(new Image());\r\n  \r\n  useEffect(() => {\r\n    watermarkImage.current.src = '/qrcode.png';\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const typesToUpdate = [];\r\n    \r\n    Object.keys(contents).forEach(type => {\r\n      if (contents[type] && !contentUpdateRef.current[type] && generatingTypes[type]) {\r\n        typesToUpdate.push(type);\r\n        contentUpdateRef.current[type] = true;\r\n      }\r\n    });\r\n    \r\n    if (typesToUpdate.length > 0) {\r\n      setAnalysisProgress(prev => {\r\n        const newProgress = {...prev};\r\n        typesToUpdate.forEach(type => {\r\n          newProgress[type] = 100;\r\n        });\r\n        return newProgress;\r\n      });\r\n      \r\n      setGeneratingTypes(prev => {\r\n        const newGenerating = {...prev};\r\n        typesToUpdate.forEach(type => {\r\n          newGenerating[type] = false;\r\n        });\r\n        return newGenerating;\r\n      });\r\n      \r\n      if (typesToUpdate.includes(loadingType)) {\r\n        setLoadingType(null);\r\n      }\r\n      \r\n      typesToUpdate.forEach(type => {\r\n        if (progressIntervals.current[type]) {\r\n          clearInterval(progressIntervals.current[type]);\r\n          progressIntervals.current[type] = null;\r\n        }\r\n      });\r\n    }\r\n  }, [contents, loadingType, generatingTypes]);\r\n\r\n  useEffect(() => {\r\n    const currentProgressIntervals = { ...progressIntervals.current };\r\n    \r\n    return () => {\r\n      Object.values(currentProgressIntervals).forEach(interval => {\r\n        if (interval) clearInterval(interval);\r\n      });\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!preview) {\r\n      ANALYSIS_TYPES.forEach(type => {\r\n        contentUpdateRef.current[type.id] = false;\r\n      });\r\n    }\r\n  }, [preview]);\r\n\r\n  useEffect(() => {\r\n    if (generating) {\r\n      Object.entries(generating).forEach(([typeId, isGenerating]) => {\r\n        if (isGenerating && !generatingTypes[typeId]) {\r\n          setGeneratingTypes(prev => ({\r\n            ...prev,\r\n            [typeId]: true\r\n          }));\r\n          \r\n          setAnalysisProgress(prev => ({\r\n            ...prev,\r\n            [typeId]: 0\r\n          }));\r\n          \r\n          if (progressIntervals.current[typeId]) {\r\n            clearInterval(progressIntervals.current[typeId]);\r\n          }\r\n          \r\n          const interval = setInterval(() => {\r\n            setAnalysisProgress(prevProgress => {\r\n              const currentProgress = prevProgress[typeId];\r\n              \r\n              if (contentUpdateRef.current[typeId] || currentProgress >= 95) {\r\n                clearInterval(interval);\r\n                return prevProgress;\r\n              }\r\n              \r\n              return {\r\n                ...prevProgress,\r\n                [typeId]: Math.min(currentProgress + 1, 95)\r\n              };\r\n            });\r\n          }, 300);\r\n          \r\n          progressIntervals.current[typeId] = interval;\r\n        }\r\n      });\r\n    }\r\n  }, [generating, generatingTypes]);\r\n\r\n  const handleShare = async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(window.location.href);\r\n      setIsCopied(true);\r\n      \r\n      setTimeout(async () => {\r\n        try {\r\n          const hasShared = await window.confirm(\r\n            '链接已复制！\\n\\n请将链接分享到社交平台\\n是否已完成分享？'\r\n          );\r\n          if (hasShared) {\r\n            setIsShared(true);\r\n          }\r\n        } catch (err) {\r\n          setError('分享确认失败');\r\n        }\r\n      }, 1000);\r\n\r\n      setTimeout(() => setIsCopied(false), 3000);\r\n    } catch (err) {\r\n      setError('复制链接失败，请手动复制地址栏链接');\r\n      setTimeout(async () => {\r\n        try {\r\n          const hasShared = await window.confirm(\r\n            '请将链接分享到社交平台\\n是否已完成分享？'\r\n          );\r\n          if (hasShared) {\r\n            setIsShared(true);\r\n          }\r\n        } catch (err) {\r\n          setError('分享确认失败');\r\n        }\r\n      }, 1000);\r\n    }\r\n  };\r\n\r\n  const handleScreenshot = async () => {\r\n    try {\r\n      if (!contentRef.current) {\r\n        throw new Error('内容区域未准备就绪');\r\n      }\r\n\r\n      const canvas = await html2canvas(contentRef.current, {\r\n        useCORS: true,\r\n        allowTaint: true,\r\n        logging: false,\r\n        backgroundColor: '#ffffff'\r\n      });\r\n\r\n      const watermarkCanvas = document.createElement('canvas');\r\n      const ctx = watermarkCanvas.getContext('2d');\r\n      \r\n      watermarkCanvas.width = canvas.width;\r\n      watermarkCanvas.height = canvas.height;\r\n      \r\n      ctx.drawImage(canvas, 0, 0);\r\n      \r\n      ctx.fillStyle = '#FF0000';\r\n      ctx.font = 'bold 48px Microsoft YaHei';\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'top';\r\n      ctx.fillText('🌟 本报告由AI命理引擎生成 | www.mingli.xin', canvas.width / 2, 30);\r\n\r\n      if (watermarkImage.current.complete) {\r\n        ctx.globalAlpha = 0.8;\r\n        ctx.drawImage(\r\n          watermarkImage.current,\r\n          canvas.width - 300,\r\n          100,\r\n          284,\r\n          318\r\n        );\r\n      }\r\n\r\n      const finalUrl = watermarkCanvas.toDataURL('image/png');\r\n      \r\n      const fileName = `命理分析报告_${new Date().toLocaleDateString()}.png`;\r\n      const link = document.createElement('a');\r\n      link.href = finalUrl;\r\n      link.download = fileName;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n\r\n    } catch (error) {\r\n      setError('生成报告失败，请稍后重试');\r\n    }\r\n  };\r\n  \r\n  useEffect(() => {\r\n    if (typeof preview === 'string' && preview.length > 0) {\r\n      const splitIndex = Math.floor(preview.length * 0.9);\r\n      setDisplayContent(preview.slice(0, splitIndex));\r\n      setBlurContent(preview.slice(splitIndex));\r\n    }\r\n  }, [preview]);\r\n\r\n  return (\r\n    <div className=\"analysis-container\" ref={contentRef}>\r\n      {error && (\r\n        <div className=\"error-message\" onClick={() => setError('')}>\r\n          ❌ {error}\r\n        </div>\r\n      )}\r\n\r\n      <h2>基础命理分析</h2>\r\n\r\n      {!onComplete ? (\r\n        <ReactMarkdown>{preview}</ReactMarkdown>\r\n      ) : (\r\n        <div className=\"preview-section\">\r\n          <ReactMarkdown>{displayContent}</ReactMarkdown>\r\n          {blurContent && (\r\n            <div className={`blur-section ${(selectedType || isShared) ? 'unlocked' : 'locked'}`}>\r\n              <ReactMarkdown>{blurContent}</ReactMarkdown>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {onComplete && (\r\n        <>\r\n          <div className=\"share-section\">\r\n            {!(selectedType || isShared) && (\r\n              <div className=\"share-container\">\r\n                <button \r\n                  onClick={handleShare}\r\n                  className=\"share-trigger\"\r\n                >\r\n                  🔗 复制链接分享解锁\r\n                </button>\r\n                <span className=\"tooltip\">分享给微信好友即可查看完整解析</span>\r\n              </div>\r\n            )}\r\n            \r\n            {isCopied && (\r\n              <div className=\"copied-notice\">\r\n                ✅ 链接已复制到剪贴板！\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"analysis-modules\">\r\n            {ANALYSIS_TYPES.map((type) => (\r\n              <div\r\n                key={type.id}\r\n                className={`analysis-module ${\r\n                  unlocked[type.id] ? 'unlocked' : 'locked'\r\n                } ${selectedType === type.id ? 'active' : ''}`}\r\n                style={{ backgroundColor: type.color }}\r\n                onClick={() => handleTypeSelection(type.id)}\r\n              >\r\n                <div className=\"module-header\">\r\n                  <span className=\"icon\">{type.icon}</span>\r\n                  <h3>{type.name}</h3>\r\n                </div>\r\n                <div className=\"module-status\">\r\n                {\r\n                  unlocked[type.id]\r\n                    ? generating[type.id]\r\n                      ? (\r\n                        analysisProgress[type.id] === 0\r\n                          ? <div className=\"progress-text\">处理中...</div>\r\n                          : <>\r\n                              <div className=\"analysis-progress-container\">\r\n                                <div className=\"analysis-progress-bar\" style={{ width: `${analysisProgress[type.id]}%` }}></div>\r\n                              </div>\r\n                              <div className=\"analysis-progress-percentage\">{analysisProgress[type.id]}%</div>\r\n                            </>\r\n                      )\r\n                      : (contents[type.id] ? '✓ 已解锁' : <div className=\"loader\" />)\r\n                    : '￥0.99解锁'\r\n                }\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {selectedType && (contents[selectedType] || generating[selectedType]) && (\r\n            <div className=\"detail-content\">\r\n              <div className=\"detail-header\">\r\n                <h3>{ANALYSIS_TYPES.find(type => type.id === selectedType)?.name}</h3>\r\n              </div>\r\n              {contents[selectedType] ? (\r\n                <ReactMarkdown>{contents[selectedType]}</ReactMarkdown>\r\n              ) : generating[selectedType] ? (\r\n                <div className=\"loading-content\">内容生成中，请稍候...</div>\r\n              ) : (\r\n                <div className=\"error-content\">内容加载失败</div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n      <button className=\"action-button back\" onClick={onGoBack}>\r\n        ← 返回主页\r\n      </button>\r\n      <button className=\"action-button screenshot\" onClick={handleScreenshot}>\r\n        📸 截图保存\r\n      </button>\r\n\r\n      <div className=\"disclaimer\">\r\n        <p>※ 本分析由AI生成，仅供娱乐参考，不作为决策依据</p>\r\n        <p>※ 根据相关法规，所有数据将在24小时后自动删除</p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst propsAreEqual = (prevProps, nextProps) => {\r\n  return (\r\n    prevProps.preview === nextProps.preview &&\r\n    prevProps.onComplete === nextProps.onComplete &&\r\n    JSON.stringify(prevProps.unlocked) === JSON.stringify(nextProps.unlocked) &&\r\n    JSON.stringify(prevProps.contents) === JSON.stringify(nextProps.contents) &&\r\n    JSON.stringify(prevProps.generating) === JSON.stringify(nextProps.generating)\r\n  );\r\n};\r\n\r\nexport default React.memo(AnalysisSection, propsAreEqual);\r\n","const BASE_URL =  \"http://8.133.207.19:5000\";\r\n\r\n// SSE连接创建函数 - 包含重连机制\r\nconst createEventSourceWithRetry = (url, handlers, maxRetries = 3) => {\r\n  let retryCount = 0;\r\n  let es;\r\n\r\n  const connect = () => {\r\n    es = new EventSource(url);\r\n    \r\n    es.onopen = () => {\r\n      retryCount = 0;\r\n    };\r\n\r\n    es.onerror = (err) => {\r\n      if (retryCount < maxRetries) {\r\n        retryCount++;\r\n        setTimeout(() => {\r\n          es.close();\r\n          connect();\r\n        }, 1000 * retryCount); // 递增重试延迟\r\n      } else {\r\n        handlers.onError?.('连接已断开,请刷新页面重试');\r\n        es.close();\r\n      }\r\n    };\r\n\r\n    return es;\r\n  };\r\n\r\n  return connect();\r\n};\r\n\r\n\r\n\r\n// 创建八字分析SSE流\r\nexport const createOrderStream = (eightCharacters, handlers) => {\r\n  const url = `${BASE_URL}/api/orders/stream?eightCharacters=${encodeURIComponent(eightCharacters)}`;\r\n  const es = createEventSourceWithRetry(url, handlers);\r\n\r\n  // 监听不同类型的事件\r\n  es.addEventListener('stream', (e) => {\r\n    try {\r\n      const data = JSON.parse(e.data);\r\n      handlers.onStream?.(data.content);\r\n    } catch (error) {\r\n      handlers.onError?.('数据解析错误');\r\n      es.close();\r\n    }\r\n  });\r\n\r\n  es.addEventListener('stream_end', (e) => {\r\n    try {\r\n      const data = JSON.parse(e.data);\r\n      handlers.onComplete?.(data.orderId);\r\n      es.close();\r\n    } catch (error) {\r\n      handlers.onError?.('数据解析错误');\r\n      es.close();\r\n    }\r\n  });\r\n\r\n  es.addEventListener('error', (e) => {\r\n    try {\r\n      if(e.data) {\r\n        const data = JSON.parse(e.data);\r\n        handlers.onError?.(data.message);\r\n      }\r\n      es.close();\r\n    } catch (error) {\r\n      handlers.onError?.('连接错误');\r\n      es.close();\r\n    }\r\n  });\r\n\r\n  return es;\r\n};\r\n\r\n// 支付和详细分析SSE流\r\nexport const initiatePayment = (prevOrderId, analysisType, handlers) => {\r\n  const url = `${BASE_URL}/api/orders/${prevOrderId}/payment?type=${analysisType}`;\r\n  const es = createEventSourceWithRetry(url, handlers);\r\n\r\n  const safeParseJson = (data, defaultValue = null) => {\r\n    try {\r\n      return JSON.parse(data);\r\n    } catch (error) {\r\n      handlers.onError?.('数据解析错误');\r\n      es.close();\r\n      return defaultValue;\r\n    }\r\n  };\r\n\r\n  // 监听支付相关事件\r\n  es.addEventListener('payment', (e) => {\r\n    const data = safeParseJson(e.data);\r\n    if (data?.qrcodeUrl && data?.Price) {\r\n      handlers.onPaymentQR?.(data.qrcodeUrl, data.Price);\r\n    }\r\n  });\r\n\r\n  es.addEventListener('payment_success', () => {\r\n    handlers.onPaymentstatus?.();\r\n  });\r\n\r\n  // 已支付事件，给出生成结果\r\n  es.addEventListener('already_paid', (e) => {\r\n    const data = safeParseJson(e.data);\r\n    if (data?.content) {\r\n      handlers.onAlreadyPaid?.(data.content);\r\n      es.close();\r\n    }\r\n  });\r\n\r\n  // 提示未生成完成，稍等后重试\r\n  es.addEventListener('try_again', () => {\r\n    handlers.onTryAgain?.();\r\n    es.close();\r\n  });\r\n\r\n  // 监听分析内容流式传输\r\n  es.addEventListener('stream', (e) => {\r\n    const data = safeParseJson(e.data);\r\n    if (data?.content) {\r\n      handlers.onAnalysisChunk?.(data.content);\r\n    }\r\n  });\r\n\r\n  es.addEventListener('stream_end', () => {\r\n    handlers.onAnalysisEnd?.();\r\n    es.close();\r\n  });\r\n\r\n  es.addEventListener('error', (e) => {\r\n    if (e.data) {\r\n      const data = safeParseJson(e.data);\r\n      if (data?.message) {\r\n        handlers.onError?.(data.message);\r\n      } else {\r\n        handlers.onError?.('支付流程出错');\r\n      }\r\n    }\r\n    es.close();\r\n  });\r\n\r\n  return es;\r\n};","import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport Form from './components/Form';\nimport PaymentModal from './components/PaymentModal';\nimport AnalysisSection from './components/AnalysisSection';\nimport './App.css';\nimport { createOrderStream, initiatePayment } from './api';\n\nconst ANALYSIS_TYPES = [\n  { id: 'health', name: '健康分析' },\n  { id: 'career', name: '事业分析' },\n  { id: 'wealth', name: '财运分析' },\n  { id: 'marriage', name: '婚姻分析' }\n];\n\nfunction App() {\n  const [analysisData, setAnalysisData] = useState({\n    currentOrderId: null,\n    preview: '',\n    unlocked: {},\n    contents: {\n      health: null,\n      career: null,\n      wealth: null,\n      marriage: null\n    },\n    analysisOrderIds: {\n      health: null,\n      career: null,\n      wealth: null,\n      marriage: null\n    },\n    paymentInfo: {\n      health: null,\n      career: null,\n      wealth: null,\n      marriage: null\n    },\n    generating: {\n      health: false,\n      career: false,\n      wealth: false,\n      marriage: false\n    }\n  });\n  const [paymentState, setPaymentState] = useState({\n    show: false,\n    qrcodeUrl: '',\n    processingType: null,\n    expiresAt: null,\n    price: 0.99\n  });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [connections, setConnections] = useState({\n    main: null,\n    health: null,\n    career: null,\n    wealth: null,\n    marriage: null\n  });\n  const [progress, setProgress] = useState(0);\n  const [resetLoadingTypeCallback, setResetLoadingTypeCallback] = useState(null);\n\n  const closeConnection = (type) => {\n    if (connections[type]) {\n      connections[type].close();\n      setConnections(prev => ({\n        ...prev,\n        [type]: null\n      }));\n    }\n  };\n\n  const closeAllConnections = useCallback(() => {\n    Object.keys(connections).forEach(type => {\n      if (connections[type]) {\n        connections[type].close();\n      }\n    });\n    setConnections({\n      main: null,\n      health: null,\n      career: null,\n      wealth: null,\n      marriage: null\n    });\n  }, [connections]);\n\n  const storage = useMemo(() => ({\n    save: (data) => {\n      if (typeof data !== 'object' || data === null) {\n        setError('无法保存无效的分析数据');\n        return false;\n      }\n  \n      try {\n        localStorage.setItem('analysisData', JSON.stringify(data));\n        return true;\n      } catch (error) {\n        setError('保存数据失败，请检查浏览器存储空间');\n        return false;\n      }\n    },\n  \n    load: () => {\n      try {\n        const data = localStorage.getItem('analysisData');\n        if (!data) return null;\n  \n        const parsedData = JSON.parse(data);\n  \n        if (\n          typeof parsedData === 'object' &&\n          parsedData !== null &&\n          typeof parsedData.preview === 'string' &&\n          typeof parsedData.unlocked === 'object' &&\n          typeof parsedData.contents === 'object' &&\n          typeof parsedData.currentOrderId === 'string' &&\n          typeof parsedData.analysisOrderIds === 'object'\n        ) {\n          if (!parsedData.paymentInfo) {\n            parsedData.paymentInfo = { health: null, career: null, wealth: null, marriage: null };\n          }\n          if (!parsedData.generating) {\n            parsedData.generating = { health: false, career: false, wealth: false, marriage: false };\n          }\n          return parsedData;\n        }\n        \n        throw new Error('数据格式不正确');\n      } catch (error) {\n        localStorage.removeItem('analysisData');\n        return null;\n      }\n    },\n\n    savePaymentInfo: (type, paymentInfo) => {\n      try {\n        const key = `payment_${type}`;\n        if (paymentInfo === null) {\n          localStorage.removeItem(key);\n        } else {\n          localStorage.setItem(key, JSON.stringify(paymentInfo));\n        }\n        return true;\n      } catch (error) {\n        console.error('保存支付信息失败', error);\n        return false;\n      }\n    },\n\n    loadPaymentInfo: (type) => {\n      try {\n        const key = `payment_${type}`;\n        const data = localStorage.getItem(key);\n        if (!data) return null;\n        \n        return JSON.parse(data);\n      } catch (error) {\n        localStorage.removeItem(`payment_${type}`);\n        return null;\n      }\n    }\n  }), [setError]);\n\n  const initialAnalysisState = {\n    currentOrderId: null,\n    preview: '',\n    unlocked: {},\n    contents: { health: '', career: '', wealth: '', marriage: '' },\n    analysisOrderIds: { health: null, career: null, wealth: null, marriage: null },\n    paymentInfo: { health: null, career: null, wealth: null, marriage: null },\n    generating: { health: false, career: false, wealth: false, marriage: false }\n  };\n\n  const clearAnalysisData = () => {\n    try {\n      localStorage.removeItem('analysisData');\n      ANALYSIS_TYPES.forEach(type => {\n        storage.savePaymentInfo(type.id, null);\n      });\n      setAnalysisData(initialAnalysisState);\n      setPaymentState({ show: false, qrcodeUrl: '', processingType: null, expiresAt: null, price: 0.99 });\n      setLoading(false);\n      setError('');\n      setProgress(0);\n      closeAllConnections();\n    } catch (error) {\n      setError('清除数据失败');\n    }\n  };\n  \n  const handleSubmit = async (eightCharacters) => {\n    setLoading(true);\n    setError('');\n    setAnalysisData(initialAnalysisState);\n    setProgress(0);\n\n    closeAllConnections();\n\n    const progressInterval = setInterval(() => {\n      setProgress(prev => {\n        if (prev >= 95) {\n          clearInterval(progressInterval);\n          return 95;\n        }\n        return prev + 1;\n      });\n    }, 200);\n\n    const newES = createOrderStream(eightCharacters, {\n      onStream: (chunk) => {\n        setAnalysisData(prev => ({\n          ...prev,\n          preview: prev.preview + chunk\n        }));\n        setLoading(false);\n        setProgress(100);\n        clearInterval(progressInterval);\n      },\n      onComplete: (prevOrderId) => {\n        setAnalysisData(prev => ({\n          ...prev,\n          currentOrderId: prevOrderId\n        }));\n      },\n      onError: (message) => {\n        setError(message || '生成预览失败');\n        setLoading(false);\n        clearInterval(progressInterval);\n      }\n    });\n    \n    setConnections(prev => ({\n      ...prev,\n      main: newES\n    }));\n  };\n\n  const unlockAnalysis = (type) => {\n    // 如果已经解锁该类型，则直接返回\n    if (analysisData.unlocked[type]) return Promise.resolve();\n    \n    if (!analysisData.currentOrderId) return Promise.resolve();\n\n    const now = Date.now();\n    const existingPayment = storage.loadPaymentInfo(type);\n    \n    closeConnection(type);\n    \n    if (existingPayment && existingPayment.expiresAt > now) {\n      setAnalysisData(prev => ({\n        ...prev,\n        paymentInfo: {\n          ...prev.paymentInfo,\n          [type]: existingPayment\n        },\n        analysisOrderIds: {\n          ...prev.analysisOrderIds,\n          [type]: existingPayment.orderId\n        }\n      }));\n      \n      setPaymentState({\n        show: true,\n        qrcodeUrl: existingPayment.qrcodeUrl,\n        processingType: type,\n        expiresAt: existingPayment.expiresAt,\n        price: existingPayment.price\n      });\n      \n      setupPaymentConnection(type, existingPayment.orderId);\n      return Promise.resolve();\n    }\n\n    const initialPaymentState = {\n      show: true,\n      qrcodeUrl: '',\n      processingType: type,\n      expiresAt: null,\n      price: 0.99\n    };\n    setPaymentState(initialPaymentState);\n\n    setupPaymentConnection(type);\n    return Promise.resolve();\n  };\n\n  const setupPaymentConnection = (type, existingOrderId = null) => {\n    const paymentES = initiatePayment(\n      analysisData.currentOrderId,\n      type,\n      {\n        onPaymentQR: (qrcodeUrl, price) => {\n          const expiresAt = Date.now() + 5 * 60 * 1000;\n          \n          const paymentInfo = {\n            qrcodeUrl,\n            orderId: price,\n            expiresAt,\n            createdAt: Date.now(),\n            price: price\n          };\n          \n          setPaymentState(prev => ({ \n            ...prev, \n            qrcodeUrl,\n            expiresAt,\n            price \n          }));\n          \n          setAnalysisData(prev => ({\n            ...prev,\n            analysisOrderIds: {\n              ...prev.analysisOrderIds,\n              [type]: price\n            },\n            paymentInfo: {\n              ...prev.paymentInfo,\n              [type]: paymentInfo\n            }\n          }));\n          \n          storage.savePaymentInfo(type, paymentInfo);\n        },\n        onAlreadyPaid: (content) => {\n          setAnalysisData(prev => ({\n            ...prev,\n            unlocked: { ...prev.unlocked, [type]: true },\n            contents: { ...prev.contents, [type]: content },\n            paymentInfo: { ...prev.paymentInfo, [type]: null },\n            generating: { ...prev.generating, [type]: false }\n          }));\n          setPaymentState({ show: false, qrcodeUrl: '', processingType: null, expiresAt: null, price: 0.99 });\n          storage.savePaymentInfo(type, null);\n          closeConnection(type);\n        },\n        onTryAgain: () => {\n          setError(`${type}分析正在处理中，请稍后再试`);\n          setPaymentState({ show: false, qrcodeUrl: '', processingType: null, expiresAt: null, price: 0.99 });\n          closeConnection(type);\n        },\n        onAnalysisChunk: (chunk) => {\n          setAnalysisData(prev => ({\n            ...prev,\n            contents: {\n              ...prev.contents,\n              [type]: (prev.contents[type] || '') + chunk\n            }\n          }));\n        },\n        onPaymentstatus: () => {\n          setAnalysisData(prev => ({\n            ...prev,\n            unlocked: { ...prev.unlocked, [type]: true },\n            paymentInfo: { ...prev.paymentInfo, [type]: null },\n            generating: { ...prev.generating, [type]: true }\n          }));\n          setPaymentState({ show: false, qrcodeUrl: '', processingType: null, expiresAt: null, price: 0.99 });\n          storage.savePaymentInfo(type, null);\n        },\n        onAnalysisEnd: () => {\n          setAnalysisData(prev => ({\n            ...prev,\n            generating: { ...prev.generating, [type]: false }\n          }));\n          closeConnection(type);\n        },\n        onError: (message) => {\n          setError(message || '支付流程出错');\n          setPaymentState({ show: false, qrcodeUrl: '', processingType: null, expiresAt: null, price: 0.99 });\n          closeConnection(type);\n        }\n      },\n      existingOrderId\n    );\n\n    setConnections(prev => ({\n      ...prev,\n      [type]: paymentES\n    }));\n  };\n\n  const handleResetLoadingType = callback => {\n    setResetLoadingTypeCallback(() => callback);\n  };\n\n  const handleClosePaymentModal = () => {\n    if (paymentState.processingType) {\n      closeConnection(paymentState.processingType);\n    }\n    \n    setPaymentState({ show: false, qrcodeUrl: '', processingType: null, expiresAt: null, price: 0.99 });\n    if (resetLoadingTypeCallback) {\n      resetLoadingTypeCallback();\n    }\n  };\n\n  useEffect(() => {\n    if (analysisData.preview) {\n      storage.save(analysisData);\n    }\n  }, [analysisData, storage]);\n\n  useEffect(() => {\n    const loadedData = storage.load();\n    if (loadedData) {\n      setAnalysisData(loadedData);\n    }\n    return () => {\n      closeAllConnections();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [storage]);\n\n  useEffect(() => {\n    ANALYSIS_TYPES.forEach(type => {\n      const paymentInfo = storage.loadPaymentInfo(type.id);\n      if (paymentInfo) {\n        if (paymentInfo.expiresAt > Date.now()) {\n          setAnalysisData(prev => ({\n            ...prev,\n            paymentInfo: {\n              ...prev.paymentInfo,\n              [type.id]: paymentInfo\n            },\n            analysisOrderIds: {\n              ...prev.analysisOrderIds,\n              [type.id]: paymentInfo.orderId\n            }\n          }));\n        } else {\n          storage.savePaymentInfo(type.id, null);\n        }\n      }\n    });\n  }, [storage]);\n\n  return (\n    <div className=\"App\">\n      <header className=\"header\">\n        <div className=\"header-content\">\n          <div className=\"branding\">\n            <h1>MingLi理命</h1>\n            <p className=\"slogan\">一阴一阳之谓道</p>\n          </div>\n          <div className=\"logo-container\">\n            <img src=\"/logo.png\" alt=\"Logo\" className=\"logo\" />\n          </div>\n        </div>\n      </header>\n\n        {error && <div className=\"error-message\">{error}</div>}\n        \n        {loading ? (\n            <div className=\"loading-wrapper\">\n            <div className=\"loading\">\n              <div className=\"loading-text\">\n                ⏳ 深度分析通常需要 30 秒\n                <div className=\"sub-hint\">（期间请不要刷新页面）</div>\n              </div>\n              <div className=\"progress-container\">\n                <div \n                  className=\"progress-bar\" \n                  style={{ width: `${progress}%` }}\n                ></div>\n              </div>\n              <div className=\"progress-percentage\">{progress}%</div>\n            </div>\n          </div>\n        ) : (\n          !analysisData.preview ? (\n            <Form onSubmit={handleSubmit} />\n          ) : (\n            <AnalysisSection\n              preview={analysisData.preview}\n              unlocked={analysisData.unlocked}\n              contents={analysisData.contents}\n              onUnlock={unlockAnalysis}\n              analysisTypes={ANALYSIS_TYPES}\n              onGoBack={clearAnalysisData}\n              onComplete={analysisData.currentOrderId}\n              generating={analysisData.generating}\n              onResetLoadingType={handleResetLoadingType}\n            />\n          )\n        )}\n\n        <PaymentModal\n          isOpen={paymentState.show}\n          qrcodeUrl={paymentState?.qrcodeUrl}\n          onClose={handleClosePaymentModal}\n          expiresAt={paymentState.expiresAt}\n          price={paymentState.price}\n        />\n    \n      <footer>\n        <div className=\"sfooterContent\">\n          <p className=\"sdisclaimer\">\n            拒绝向未成年人提供服务，仅供娱乐和参考。\n          </p>\n          <p className=\"sdisclaimer\">\n          ©2025 MingLi理命\n          </p>\n        </div>\n      </footer>\n\n    </div>\n    \n  );\n}\n\nexport default App;\n\n\n\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}